[{"data":1,"prerenderedAt":323},["Reactive",2],{"content-query-pcJ0VlT9lD":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"body":10,"_type":318,"_id":319,"_source":320,"_file":321,"_extension":322},"/docs/core-tech/one-side-payments","core-tech",false,"","One Side Payments","In MW in order to create a valid transaction all the parties must collaborate. Here we'll present a one-side payment scheme, which, after initial setup, allows arbitrary senders to pay specified (fixed) values to a particular receiver, without any further collaboration from the receiver side.",{"type":11,"children":12,"toc":309},"root",[13,20,27,32,83,103,114,119,125,130,137,167,172,178,183,189,194,200,205,224,229,260,266,271,277,283,288,293,298,304],{"type":14,"tag":15,"props":16,"children":17},"element","p",{},[18],{"type":19,"value":9},"text",{"type":14,"tag":21,"props":22,"children":24},"h1",{"id":23},"principle",[25],{"type":19,"value":26},"Principle",{"type":14,"tag":15,"props":28,"children":29},{},[30],{"type":19,"value":31},"In order to receive a payment the receiver creates and publishes the following:",{"type":14,"tag":33,"props":34,"children":35},"ul",{},[36,42,47,60],{"type":14,"tag":37,"props":38,"children":39},"li",{},[40],{"type":19,"value":41},"The value that it expects to receive",{"type":14,"tag":37,"props":43,"children":44},{},[45],{"type":19,"value":46},"An UTXO (commitment + Bulletproof) that encodes the above value, with arbitrary blinding factor",{"type":14,"tag":37,"props":48,"children":49},{},[50,52,58],{"type":19,"value":51},"A ",{"type":14,"tag":53,"props":54,"children":55},"em",{},[56],{"type":19,"value":57},"compensatory",{"type":19,"value":59}," kernel that compensates for the above blinding factor",{"type":14,"tag":37,"props":61,"children":62},{},[63,65],{"type":19,"value":64},"Optionally: a signed payment proof\n",{"type":14,"tag":33,"props":66,"children":67},{},[68,73,78],{"type":14,"tag":37,"props":69,"children":70},{},[71],{"type":19,"value":72},"Should include the received value, and the above kernel ID",{"type":14,"tag":37,"props":74,"children":75},{},[76],{"type":19,"value":77},"No sender address, since it's unknown, plus payment may come from multiple senders",{"type":14,"tag":37,"props":79,"children":80},{},[81],{"type":19,"value":82},"Should be signed by a private key bound to the receiver identity",{"type":14,"tag":15,"props":84,"children":85},{},[86,88,94,96,101],{"type":19,"value":87},"The above UTXO and the kernel form a part of the transaction with zero (or any other ",{"type":14,"tag":89,"props":90,"children":91},"u",{},[92],{"type":19,"value":93},"known",{"type":19,"value":95}," value) blinding factor, and a known value on output. Let's call it an ",{"type":14,"tag":53,"props":97,"children":98},{},[99],{"type":19,"value":100},"acceptor",{"type":19,"value":102}," part.",{"type":14,"tag":15,"props":104,"children":105},{},[106,108,113],{"type":19,"value":107},"In order to pay this receiver the sender create its own transaction part, which has appropriate value on input, and the kernel that compensates for its blinding factor. Call it a ",{"type":14,"tag":53,"props":109,"children":110},{},[111],{"type":19,"value":112},"donor",{"type":19,"value":102},{"type":14,"tag":15,"props":115,"children":116},{},[117],{"type":19,"value":118},"Together those 2 parts form a valid transaction with 2 kernels.",{"type":14,"tag":21,"props":120,"children":122},{"id":121},"why-this-is-not-good-enough",[123],{"type":19,"value":124},"Why this is not good enough",{"type":14,"tag":15,"props":126,"children":127},{},[128],{"type":19,"value":129},"The above scheme is na√Øve, and there are several problems with it.",{"type":14,"tag":131,"props":132,"children":134},"h2",{"id":133},"value-can-be-stolen",[135],{"type":19,"value":136},"Value can be stolen",{"type":14,"tag":15,"props":138,"children":139},{},[140,142,146,148,152,154,159,161,165],{"type":19,"value":141},"As we said, the above transaction consists of two parts: the ",{"type":14,"tag":53,"props":143,"children":144},{},[145],{"type":19,"value":112},{"type":19,"value":147}," and the ",{"type":14,"tag":53,"props":149,"children":150},{},[151],{"type":19,"value":100},{"type":19,"value":153},". Means it's ",{"type":14,"tag":89,"props":155,"children":156},{},[157],{"type":19,"value":158},"not atomic",{"type":19,"value":160},". A malicious node may delete the original ",{"type":14,"tag":53,"props":162,"children":163},{},[164],{"type":19,"value":100},{"type":19,"value":166}," part, and instead substitute its own, effectively stealing the value.",{"type":14,"tag":15,"props":168,"children":169},{},[170],{"type":19,"value":171},"If the above payment scheme was agreed secretly between the sender and the receiver - still there's a chance the receiver is colluded with the miners.",{"type":14,"tag":131,"props":173,"children":175},{"id":174},"impossible-to-prove-the-payment",[176],{"type":19,"value":177},"Impossible to prove the payment",{"type":14,"tag":15,"props":179,"children":180},{},[181],{"type":19,"value":182},"Normally the existence of the kernel in the blockchain together with the payment proof signed by the receiver unambiguously prove the payment. However in this case the signed payment proof doesn't include the sender address, and the sender can't prove that the payment was made by him/her.",{"type":14,"tag":21,"props":184,"children":186},{"id":185},"improved-scheme",[187],{"type":19,"value":188},"Improved scheme",{"type":14,"tag":15,"props":190,"children":191},{},[192],{"type":19,"value":193},"In BEAM the above issues are solved by the following extensions to the protocol.",{"type":14,"tag":131,"props":195,"children":197},{"id":196},"kernel-fusion",[198],{"type":19,"value":199},"Kernel fusion",{"type":14,"tag":15,"props":201,"children":202},{},[203],{"type":19,"value":204},"In BEAM it's possible to create a transaction kernel which includes \"internally\" arbitrary number of additional ones. The kernel signature accounts for all the contents, so it's not feasible to tamper with it.",{"type":14,"tag":15,"props":206,"children":207},{},[208,210,215,217,222],{"type":19,"value":209},"So, in order to send a payment, the sender creates a ",{"type":14,"tag":53,"props":211,"children":212},{},[213],{"type":19,"value":214},"composite",{"type":19,"value":216}," kernel, which includes ",{"type":14,"tag":53,"props":218,"children":219},{},[220],{"type":19,"value":221},"internally",{"type":19,"value":223}," the receiver compensatory kernel. This makes it impossible for the attacker to remove the receiver kernel, hence the receiver UTXO also must remain. This guarantees the integrity of the transaction.",{"type":14,"tag":15,"props":225,"children":226},{},[227],{"type":19,"value":228},"In addition the sender now has an ability to prove that the payment was made by him/her. For this the sender must do the following:",{"type":14,"tag":33,"props":230,"children":231},{},[232,237,242],{"type":14,"tag":37,"props":233,"children":234},{},[235],{"type":19,"value":236},"Locate its composite kernel in the blockchain",{"type":14,"tag":37,"props":238,"children":239},{},[240],{"type":19,"value":241},"Demonstrate that it includes internally the receiver compensatory kernel, as well as the payment proof signed by the receiver, which means that this receiver kernel means accepting a specific value.",{"type":14,"tag":37,"props":243,"children":244},{},[245,247],{"type":19,"value":246},"Prove that the composite kernel indeed belongs to the sender\n",{"type":14,"tag":33,"props":248,"children":249},{},[250,255],{"type":14,"tag":37,"props":251,"children":252},{},[253],{"type":19,"value":254},"It's sufficient to prove the knowledge of the blinding factor of the \"outer\" part of the kernel. Given an arbitrary data, the sender will sign it with its blinding factor. The verifier may check it corresponds to the visible kernel excess.",{"type":14,"tag":37,"props":256,"children":257},{},[258],{"type":19,"value":259},"This scheme must be elaborated though to prevent MITM attack.",{"type":14,"tag":131,"props":261,"children":263},{"id":262},"duplicated-utxos-are-allowed-in-beam",[264],{"type":19,"value":265},"Duplicated UTXOs are allowed in BEAM",{"type":14,"tag":15,"props":267,"children":268},{},[269],{"type":19,"value":270},"This is important to allow multiple payments, as well as payments in terms of several instances of predefined values.",{"type":14,"tag":21,"props":272,"children":274},{"id":273},"additional-notes-and-caveats",[275],{"type":19,"value":276},"Additional notes and caveats",{"type":14,"tag":131,"props":278,"children":280},{"id":279},"potential-problem-with-transaction-replaying",[281],{"type":19,"value":282},"Potential problem with transaction replaying",{"type":14,"tag":15,"props":284,"children":285},{},[286],{"type":19,"value":287},"Assume receiver owns several identical UTXOs, and decides to spend only one of them in a transaction.\nThe problem is that such a transaction can be replayed (repeated) several times, without the permission of the owner, each time it will consume the next such an UTXO.",{"type":14,"tag":15,"props":289,"children":290},{},[291],{"type":19,"value":292},"To prevent this the wallet must NEVER create a transaction that spends only (potentially) duplicated UTXOs. The set of inputs must contain at least 1 unique UTXO, which is not supposed to get duplicated (with non-negligible probability).",{"type":14,"tag":15,"props":294,"children":295},{},[296],{"type":19,"value":297},"This logic must be implemented in the wallet. In the simplest case the wallet may have a single \"dummy\" UTXO (i.e. with zero value) for this. Whenever necessary it will be used as an input, whereas another unique dummy will be created on output instead of the consumed one.",{"type":14,"tag":131,"props":299,"children":301},{"id":300},"less-anonimity",[302],{"type":19,"value":303},"Less anonimity",{"type":14,"tag":15,"props":305,"children":306},{},[307],{"type":19,"value":308},"Naturally the described scheme provides less anonymity than the standard MW. This however impacts the receiver only, and basically only those UTXOs used in this scheme.",{"title":7,"searchDepth":310,"depth":310,"links":311},2,[312,313,314,315,316,317],{"id":133,"depth":310,"text":136},{"id":174,"depth":310,"text":177},{"id":196,"depth":310,"text":199},{"id":262,"depth":310,"text":265},{"id":279,"depth":310,"text":282},{"id":300,"depth":310,"text":303},"markdown","content:docs:core-tech:One-side-payments.md","content","docs/core-tech/One-side-payments.md","md",1702260905116]
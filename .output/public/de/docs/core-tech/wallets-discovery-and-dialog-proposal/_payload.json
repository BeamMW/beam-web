[{"data":1,"prerenderedAt":196},["Reactive",2],{"content-query-Z3EVb8FTd2":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":7,"body":9,"_type":191,"_id":192,"_source":193,"_file":194,"_extension":195},"/docs/core-tech/wallets-discovery-and-dialog-proposal","core-tech",false,"","Wallets Discovery And Dialog Proposal",{"type":10,"children":11,"toc":181},"root",[12,21,28,58,64,92,98,136,142,175],{"type":13,"tag":14,"props":15,"children":17},"element","h2",{"id":16},"wallets-discovery-and-dialog-proposal",[18],{"type":19,"value":20},"text","Wallets discovery and dialog proposal",{"type":13,"tag":22,"props":23,"children":25},"h3",{"id":24},"общее",[26],{"type":19,"value":27},"Общее",{"type":13,"tag":29,"props":30,"children":31},"ol",{},[32,38,43,48,53],{"type":13,"tag":33,"props":34,"children":35},"li",{},[36],{"type":19,"value":37},"Для согласования TX между кошельками происходит диалог, согласно протоколу, но туда надо добавить возможность включать произвольную информацию в пределах разумных размеров (например, любой текст, который увидит человек или любые бинарные метаданные, если общается бот или какая-то логика более высокого уровня)",{"type":13,"tag":33,"props":39,"children":40},{},[41],{"type":19,"value":42},"Для шифрования сообщений вполне пойдет принцип PGP, для чего 2м кошелькам достаточно знать публичные ключи друг друга. Рандомный ключ (+ I.V.) для AES например 256 шифруется публичным ключом собеседника (а последний может быть и RSA и EC, не важно), остальное сообщение AESом с помощью зашифрованного ключа.",{"type":13,"tag":33,"props":44,"children":45},{},[46],{"type":19,"value":47},"Главное: публичные ключи, о которых пойдет далее, относятся только к шифрованию диалога, к процессу формирования UTXO и логике самого кошелька в целом они не имеют никакого отношения",{"type":13,"tag":33,"props":49,"children":50},{},[51],{"type":19,"value":52},"Ситуации, когда одна сторона не знает, кто к ней обращается (например, некий бот собирает пожертвования на храм Бахуса и Венеры, или это обменник (*ниже)). Такой кошель уже по определению теряет часть своей анонимности и может опубликовать свой публичный ключ тем или иным образом. Доверять ли этой публикации решает сам инициатор диалога (ну вот, в качестве примера возьмем имеющиеся монетки с адресацией, когда сам адрес является ПубКл кошелька - слать туда или не слать решаем сами). Этот инициатор тогда посылает свой публичный ключ в первом сообщении",{"type":13,"tag":33,"props":54,"children":55},{},[56],{"type":19,"value":57},"В секьюрных случаях Публ ключ может быть передан по какому-либо секьюрному каналу (телеграм и т.п.) между знакомыми и вставлен в кошелек",{"type":13,"tag":22,"props":59,"children":61},{"id":60},"публикация-публичных-ключей-для-диалога-это-все-опции-имеет-смысл-реализовывать-все-что-возможно",[62],{"type":19,"value":63},"Публикация публичных ключей (для диалога!). Это все опции, имеет смысл реализовывать все что возможно",{"type":13,"tag":29,"props":65,"children":66},{},[67,72,87],{"type":13,"tag":33,"props":68,"children":69},{},[70],{"type":19,"value":71},"Есть PGP key services, которые изначально были в помощь шифрованию email, но и тут могут пригодиться. По какому либо идентификатору можно заполучить программно ПублКл",{"type":13,"tag":33,"props":73,"children":74},{},[75,77,85],{"type":19,"value":76},"Децентрализованный вариант, как еще одна опция. Ключи храним на IPFS (",{"type":13,"tag":78,"props":79,"children":83},"a",{"href":80,"rel":81},"https://ipfs.io",[82],"nofollow",[84],{"type":19,"value":80},{"type":19,"value":86},"), но там имя файла человеческое не задать, поэтому мэппинг имя->ключ можно организовать в виде смартконтракта на Eth (запись будет стоить публикующему немного, ибо это транзакция, чтение бесплатно)",{"type":13,"tag":33,"props":88,"children":89},{},[90],{"type":19,"value":91},"Прям у себя на сайте (зеленый замочек в браузере виден? копируйте-вставляйте в кошель). Или ссылку на ipfs в виде QR кода (сам ключ длинноват для QR)",{"type":13,"tag":22,"props":93,"children":95},{"id":94},"secure-channel-тоже-опции",[96],{"type":19,"value":97},"Secure channel. Тоже опции",{"type":13,"tag":29,"props":99,"children":100},{},[101,106,111,116,121,126,131],{"type":13,"tag":33,"props":102,"children":103},{},[104],{"type":19,"value":105},"Связь по TCP напрямую. Самое быстрое и простое, оба кошеля должны быть в онлайне. Но все будут знать, что эти 2 IP общались между собой",{"type":13,"tag":33,"props":107,"children":108},{},[109],{"type":19,"value":110},"Через прокси (ретранслятор). Когда кто-то или оба из кошельков за файрволлом. Тоже должны быть в онлайне, и факт общения может быть установлен. Можно запустить подобные ретрансляторы, а список известных адресов могут выдавать ноды в рамках протокола.",{"type":13,"tag":33,"props":112,"children":113},{},[114],{"type":19,"value":115},"Через инфраструктуру мессенджеров. Надо поизучать вопрос об интеграции с их АПИ. Но тут получается, что пациенты совсем друг друга хорошо знают и имеют в контактах мессенджера. Но зато есть возможность быть в оффлайне во время диалога.",{"type":13,"tag":33,"props":117,"children":118},{},[119],{"type":19,"value":120},"Броадкастить (по крайней мере 1-е сообщение диалога) через инфраструктуру beam nodes. Сообщение распространяется по сети с некоторым убывающим TTL и с высокой вероятностью доходит до кошелька. Почему ноды могут быть заинтересованы в ретрансляции этого хлама? Ну если они майнят, то такое общение может обернуться неким txFee > 0 через какое-то время. Тут проблема как экономически бороться с флудом, поскольку сообщения шифрованные, и ноды их никак валидировать не в состоянии. Может в таких случаях обязать какой-нибудь PoW приделывать к сообщению? При этой схеме тоже все стороны должны быть в онлайне и прицепиться к нодам сети на предмет прослушки таких броадкастов (и фильтрации своих из общего потока с помощью своего приватного ключа).",{"type":13,"tag":33,"props":122,"children":123},{},[124],{"type":19,"value":125},"BBS service - это ретранслятор + история. Отдельная сеть из узлов, которые реализуют \"общую шину\" для данного рода сообщений. Клиент может прицепиться к одному или нескольким таким каналам, получать по запросу некоторую историю сообщений и в реальном времени фильтровать входящие. Здесь cons и pros как что в предыдущем пункте, но есть и хорошее: 1) можно слушать из N существующих каналов M\u003CN, сообщение соответственно может быть доставлено в соответствии с какими-то битами публичного ключа в M каналов, а не все N, получатель об этом знает, но факт того, что он переварил то или иное сообщение, скрыт. 2) Оффлайн до определенной глубины времени",{"type":13,"tag":33,"props":127,"children":128},{},[129],{"type":19,"value":130},"Объединение №4 и №5: сообщение гуляет по сети и попадает в BBS так или иначе. За счет рандомного TTL затирается из истории адрес отправителя, за счет BBS неизвестен получатель.",{"type":13,"tag":33,"props":132,"children":133},{},[134],{"type":19,"value":135},"Случай когда слушатель каналов маломощный вроде мобильного клиента и/или ограничен в трафике: частично жертвуя анонимностью, поручает BBS сервису фильтровать для него канал. Для этого вместо одного публ. ключа нужно 2 штуки: 1) Selector public key, 2) Messaging public key\nСоответственно протокол диалога обогащается еще одним заголовком - некие позывные (не секретные) шифруются ключом селектора, остальное уже секретный канал",{"type":13,"tag":22,"props":137,"children":139},{"id":138},"что-хотелось-бы-в-ui-и-в-целом-в-приложении",[140],{"type":19,"value":141},"Что хотелось бы в UI и в целом в приложении",{"type":13,"tag":29,"props":143,"children":144},{},[145,150,155,160,165,170],{"type":13,"tag":33,"props":146,"children":147},{},[148],{"type":19,"value":149},"Address book - хранилище имен контрагентов и их публичных ключей. Имена уникальные лишь для этого кошелька, никакого центрального хранилища имен не надо",{"type":13,"tag":33,"props":151,"children":152},{},[153],{"type":19,"value":154},"Возможность ввести публичный ключ из clipboard и придумать для него имя",{"type":13,"tag":33,"props":156,"children":157},{},[158],{"type":19,"value":159},"Отображение сообщений, которые приходят как мета с сообщениями протокола. В этом случае владелец кошелька (или его бот) подтверждение пусть дает после приема каждой подобной меты, продолжать ли диалог",{"type":13,"tag":33,"props":161,"children":162},{},[163],{"type":19,"value":164},"Возможность поиска публичных ключей во внешних хранилищах: pgp key services, решения на ipfs и т.д.",{"type":13,"tag":33,"props":166,"children":167},{},[168],{"type":19,"value":169},"Возможность генерации своих ключей для общения, публикации публичной части под каким-либо никнеймом, индивидуальной передачи публичного ключа собеседнику по любому каналу (через telegram secret channel как пример)",{"type":13,"tag":33,"props":171,"children":172},{},[173],{"type":19,"value":174},"(??? спорный момент) Интеграция кошелька с АПИ мессенджеров",{"type":13,"tag":176,"props":177,"children":178},"p",{},[179],{"type":19,"value":180},"(*)(atomic swap отдельная тема, тут надо придумать как можно лочить TX с помощью любых видов хэшей, присутствующих в других блокчейнах, опционально и в дополнение к тому что есть, за большее fee конечно,  ... ...)",{"title":7,"searchDepth":182,"depth":182,"links":183},2,[184],{"id":16,"depth":182,"text":20,"children":185},[186,188,189,190],{"id":24,"depth":187,"text":27},3,{"id":60,"depth":187,"text":63},{"id":94,"depth":187,"text":97},{"id":138,"depth":187,"text":141},"markdown","content:docs:core-tech:Wallets-discovery-and-dialog-proposal.md","content","docs/core-tech/Wallets-discovery-and-dialog-proposal.md","md",1702260919728]
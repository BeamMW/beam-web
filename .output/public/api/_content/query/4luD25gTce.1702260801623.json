[{"_path":"/docs/core-tech/atomic-swap-token","_dir":"core-tech","_draft":false,"_partial":false,"_locale":"","title":"Atomic swap token","description":"","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"atomic-swap-token"},"children":[{"type":"text","value":"Atomic swap token"}]},{"type":"element","tag":"h2","props":{"id":"overview"},"children":[{"type":"text","value":"Overview"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Swap token is intended to allow users to exchange info about transactions(swap) via any side channels.\nIn general, token is serialized list of transaction parameters, presented as a base58 encoded byte buffer."}]},{"type":"element","tag":"h2","props":{"id":"description"},"children":[{"type":"text","value":"Description"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Token has the following fields:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"- flags              // 1 byte"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"- optional TxID      // 1 or 17 bytes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"- list of parameters // not less than 34 byte since transaction should have at least one address parameter"}]}]},{"type":"element","tag":"h3","props":{"id":"flags"},"children":[{"type":"text","value":"flags"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Flags is a 1-byte field where only the highest bit is defined the others are reserved.\n0x80 means that this is a token."}]},{"type":"element","tag":"h3","props":{"id":"tx-id"},"children":[{"type":"text","value":"tx ID"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is an optional transaction ID. All swap transaction should have this value. It is optional for the cases if we will use the token structure for other types of transaction.\nThere are two possible values:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"|0x01| 16 byte UUID|"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"|0x00| "}]}]},{"type":"element","tag":"h3","props":{"id":"transaction-parameters"},"children":[{"type":"text","value":"Transaction parameters"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Transaction parameter is a pair of the parameter key and value.\nThe key is 1 byte value and its meaning is defined by "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"TxParameterID "}]},{"type":"text","value":"enum from "},{"type":"element","tag":"a","props":{"href":"https://github.com/BeamMW/beam/blob/master/wallet/common.h","rel":["nofollow"]},"children":[{"type":"text","value":"wallet/common.h"}]},{"type":"text","value":"\nThe values are arrays of bytes and contain serialized values.\nThe value type and size is defined by the key meaning. All integer types are big-endian."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"overview","depth":2,"text":"Overview"},{"id":"description","depth":2,"text":"Description","children":[{"id":"flags","depth":3,"text":"flags"},{"id":"tx-id","depth":3,"text":"tx ID"},{"id":"transaction-parameters","depth":3,"text":"Transaction parameters"}]}]}},"_type":"markdown","_id":"content:docs:core-tech:Atomic-swap-token.md","_source":"content","_file":"docs/core-tech/Atomic-swap-token.md","_extension":"md"},{"_path":"/docs/core-tech/atomic-swap","_dir":"core-tech","_draft":false,"_partial":false,"_locale":"","title":"Atomic Swap","description":"Atomic swap is performed between Beam and other cryptocurrency. Denote it BTC, but actually it can denote other network that supports the needed functionality.","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Atomic swap is performed between Beam and other cryptocurrency. Denote it BTC, but actually it can denote other network that supports the needed functionality."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The swap is performed in a single transaction, which effectively transfers the ownership of the Beam UTXO in exchange for some secret, which is needed to claim the being-exchanged coin on the BTC network."}]},{"type":"element","tag":"h1","props":{"id":"high-level-design"},"children":[{"type":"text","value":"High-level design"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are two parties:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":"lice. Owns the Beam, interested to trade it for the BTC"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":"ob. Owns the BTC, interested to trade it for the Beam."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are 3 major phases of the atomic swap"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Prerequesites\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The being-exchanged UTXOs are locked on both networks for a specific time period (in terms of blocks)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Parties monitor both networks to ensure the source UTXOs are indeed locked."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Exchange\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Parties collaborate to create a transaction that transfers the locked Beam to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" in exchange for the secret."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" substitutes the secret to the transaction and finally broadcasts it to the network."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Once transaction is visible - "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" learns the secret."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" creates a BTC transaction to claim the BTC UTXO, and broadcasts it to the BTC network."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Rollback. In case the swap didn't take place (for whatever reason)\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Locked UTXOs on both network should remain intact until their lock timeout expires."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"After the timeout expiration parties broadcast transactions that transfers the locked UTXOs back to them."}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" actually claims the BTC UTXO "},{"type":"element","tag":"u","props":{},"children":[{"type":"text","value":"after"}]},{"type":"text","value":" sending the Beam UTXO. This means that the lock timeout of the BTC UTXO must be significantly bigger than that of the Beam UTXO, because "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" may broadcast the Beam transaction just before the timeout expires, the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" should still have enough time to build and broadcast the BTC transaction."}]},{"type":"element","tag":"h1","props":{"id":"technical-design"},"children":[{"type":"text","value":"Technical design"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"unlock secret"}]},{"type":"text","value":" is the SHA-256 hash preimage (i.e. a 256-bit value which, after hashing, should be equal to a known 256-bit value). Supported on Beam, BTC, and, probably, many other networks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Note"}]},{"type":"text","value":": The drawback of this scheme is a considerable privacy compromise. As we'll see, it's possible for the attacker to detect such an atomic swap, by looking for the matching hash preimages in both networks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There is a better option, where the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"unlock secret"}]},{"type":"text","value":" is an EC scalar, i.e. private key. It's based on the so-called aggregate signatures. It's less generic, since it assumes both networks use the same EC equation and the Generator."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So we'll review the scheme with the Hash-lock, but keep in mind that it can easily be modified to the one with the aggregate signature, and the rest of the argument, and the general flow are exactly the same."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are no scripts in Beam blockchain. However the following is supported in the transaction kernel:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Timelock - minimum blockchain height for the kernel to be valid"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"HashPreimage"}]}]},{"type":"element","tag":"h2","props":{"id":"utxo-lock-on-btc-network"},"children":[{"type":"text","value":"UTXO lock on BTC network"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" broadcasts a BTC transaction, which creates an UTXO which can be spent under the following conditions:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Timeout + secret key chosen by "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Hash preimage chosen by "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" + secret key chosen by "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]}]}]},{"type":"element","tag":"h2","props":{"id":"utxo-lock-on-beam-network"},"children":[{"type":"text","value":"UTXO lock on Beam network"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This part is somewhat more complex, since there are no scripts in Beam. "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" collaborate to create a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"shared"}]},{"type":"text","value":" UTXO, whose blinding factor is shared between them."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" randomly choose their parts of the blinding factor for the shared UTXO"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" first create the \"rollback\" transaction, which would transfer the shared UTXO back to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" if the exchange didn't take place.\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"This transaction kernel is Time-locked, i.e. transaction can only be broadcasted starting from specific blockchain height."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" saves this transaction, but doesn't broadcast yet."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" create the transaction that spends "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":"'s UTXO and creates the shared one.\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The tricky part is creating the Bulletproof for the shared UTXO. Takes 3 iterations."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"They broadcast this transaction to the Beam network, to create the shared UTXO."}]}]},{"type":"element","tag":"h2","props":{"id":"exchange-transaction"},"children":[{"type":"text","value":"Exchange transaction"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"At this point both Beam and BTC UTXOs are locked, both parties get confirmations for this. In addition "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" knows the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Image"}]},{"type":"text","value":" of the locked BTC UTXO. Now they collaborate to build a Beam transaction that transfers the shared (locked) Beam UTXO to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" in exchange for revealing the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Hash Preimage"}]},{"type":"text","value":", which, after hashing, equals to the known "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Image"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" randomly chooses the blinding factor for the new UTXO"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" creates the Transaction Kernel, which is supposed to contain the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Hash Preimage"}]},{"type":"text","value":" (but doesn't contain yet), which corresponds to the knwo "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Image"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" puts her part of the kernel multisig, which assumes the correct "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Image"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Incomplete transaction is passed to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" puts his part of the kernel multisig, which assumes the correct "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Image"}]},{"type":"text","value":" (same as Alice)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"u","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" substitutes the correct "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Hash Preimage"}]},{"type":"text","value":" to make the transaction kernel valid."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"This is where the atomic swap actually occurs!"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" broadcasts the transaction to the Beam network."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" monitors the Beam network. Once the exchange transaction kernel is visible:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" realized that the exchange occurred."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" learns the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Hash Preimage"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" creates and broadcasts the BTC transaction to claim her BTC UTXO."}]}]},{"type":"element","tag":"h1","props":{"id":"in-depth-flow-diagram"},"children":[{"type":"text","value":"In-depth flow diagram"}]},{"type":"element","tag":"h2","props":{"id":"bob"},"children":[{"type":"text","value":"Bob"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Collaborate to lock the BTC UTXO\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Pka"}]},{"type":"text","value":" from "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" - her generated pubkey for some secret key "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ska"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Generate the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hpi"}]},{"type":"text","value":" - the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Hash Preimage"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hi = Hash(hpi)"}]},{"type":"text","value":" - the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Hash Image"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Generate and broadcast the transaction that creates a locked BTC UTXO.\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The created UTXO can be spent iff both "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hpi"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ska"}]},{"type":"text","value":" are known."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hi"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Pka"}]},{"type":"text","value":" are revealed."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Send "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" this transaction (so she'll be able to identify it in the BTC network)."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Collaborate to lock the Beam UTXO\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Generate "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"sfb"}]},{"type":"text","value":" - the part of the blinding factor of the shared UTXO."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Pfa"}]},{"type":"text","value":" - "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":"'s part of the public blinding factor (of the shared UTXO)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Collaborate to sign the kernel for the transaction that transfers the shared (non-existing yet) UTXO back to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"u","props":{},"children":[{"type":"text","value":"The kernel must be time-locked"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":"'s part of the signature accounts for the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"sfb"}]},{"type":"text","value":"."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Collaborate to create the Bulletproof of the shared UTXO.\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"requires 3 iteration cycles with "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Collaborate to sign the kernel for the transaction that creates the shared UTXO\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":"'s part of the signature accounts for the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"sfb"}]},{"type":"text","value":"."}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"u","props":{},"children":[{"type":"text","value":"Wait until the mutual UTXO becomes visible"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Collaborate to build the exchange transaction\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Transaction kernel is supposed to (but doesn't yet) contain the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hpi"}]},{"type":"text","value":".\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Means - its signature signs the kernel contents, including "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Hash(hpi) == hi"}]},{"type":"text","value":", whereas "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hi"}]},{"type":"text","value":" is known to both parties."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Generate the new UTXO"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Pass it to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" so that she creates such a kernel, and substitutes her part of the signature."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get the half-signed kernel from "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":", and verify it."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"u","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Important:"}]},{"type":"text","value":" Ensure there is enough time left until the timelock of the shared UTXO expires!"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Finish the kernel signature.\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Substitute the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hpi"}]},{"type":"text","value":" as the "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Hash Preimage"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Complete the signature."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Broadcast the transaction to the Beam network."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"u","props":{},"children":[{"type":"text","value":"Wait until the exchange transaction becomes visible, or until the BTC UTXO timelock expires."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If the transaction is visible (and enough new blocks are generated above) - Congratulations! It's done."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If the BTC UTXO timelock expired and it's still unspent - take it back (create and broadcast another BTC transaction)."}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"alice"},"children":[{"type":"text","value":"Alice"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Collaborate to lock the BTC UTXO\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Generate "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ska"}]},{"type":"text","value":" - private key on the BTC network."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Send "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Pka = G * ska"}]},{"type":"text","value":" to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Receive the BTC transaction details from "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":", and verify it\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Correct amount is locked."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Can be spent using "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ska"}]},{"type":"text","value":", and a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Preimage"}]},{"type":"text","value":" of "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hi"}]},{"type":"text","value":" (the preimage is not known yet)."}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Collaborate to lock the Beam UTXO\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Select input(s) to build the transaction that creates the shared UTXO"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Generate "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"sfa"}]},{"type":"text","value":" - the part of the blinding factor of the shared UTXO."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Pfb"}]},{"type":"text","value":" - "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":"'s part of the public blinding factor (of the shared UTXO)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Collaborate with "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]},{"type":"text","value":" to build:\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A time-locked rollback transaction that transfers the shared (non-existing yet) UTXO back to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":".\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"u","props":{},"children":[{"type":"text","value":"It must be created before the shared UTXO is actually created."}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Bulletproof for the shared UTXO"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Transaction that spends the selected inputs and creates the shared UTXO"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Send the transaction to create the shared UTXO to the network"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"u","props":{},"children":[{"type":"text","value":"Wait until the locked BTC UTXO becomes visible in the BTC network"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"u","props":{},"children":[{"type":"text","value":"Ensure the BTC timelock is significantly bigger than the Beam timelock"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Collaborate to build the exchange transaction\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Transaction kernel is supposed to (but doesn't yet) contain the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hpi"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" creates such a kernel, puts her part of the signature, which\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Corresponds to her part of the shared UTXO (compensates for "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ska"}]},{"type":"text","value":")."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Would become valid only when the correct "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Hash Preimage"}]},{"type":"text","value":" ("},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hpi"}]},{"type":"text","value":") will be substituted."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Half-signed transaction is passed to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"B"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"u","props":{},"children":[{"type":"text","value":"Wait until the exchange transaction becomes visible, or until the Beam UTXO timelock expires."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Once the transaction is visible:\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" learns the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"hpi"}]},{"type":"text","value":" from the visible transaction kernel"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" Creates and broadcasts the BTC transaction to claim the BTC UTXO"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If the Beam UTXO timelock expired and it's still unspent\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Broadcast the rollback transaction to the network"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Wait until the transaction (either post-exchange or the rollback) becomes visible."}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"swap-diagram"},"children":[{"type":"text","value":"Swap diagram"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Atomic Swap Diagram","src":"https://user-images.githubusercontent.com/2501619/60335463-abf39900-99a6-11e9-83ae-9494ea9e3577.png"},"children":[]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"utxo-lock-on-btc-network","depth":2,"text":"UTXO lock on BTC network"},{"id":"utxo-lock-on-beam-network","depth":2,"text":"UTXO lock on Beam network"},{"id":"exchange-transaction","depth":2,"text":"Exchange transaction"},{"id":"bob","depth":2,"text":"Bob"},{"id":"alice","depth":2,"text":"Alice"},{"id":"swap-diagram","depth":2,"text":"Swap diagram"}]}},"_type":"markdown","_id":"content:docs:core-tech:Atomic-swap.md","_source":"content","_file":"docs/core-tech/Atomic-swap.md","_extension":"md"}]
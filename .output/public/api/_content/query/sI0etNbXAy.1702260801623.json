{"_path":"/docs/core-tech/core-transaction-elements","_dir":"core-tech","_draft":false,"_partial":false,"_locale":"","title":"Core data types used in BEAM:","description":"","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"core-data-types-used-in-beam"},"children":[{"type":"text","value":"Core data types used in BEAM:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Height"}]},{"type":"text","value":" - 64-bit unsigned integer"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"HeightRange"}]},{"type":"text","value":" - a pair of "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Height"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Timestamp"}]},{"type":"text","value":" - 64-bit unsigned integer"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Amount"}]},{"type":"text","value":" - used to denote the value of a single UTXO. 64-bit unsigned integer"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"AmountBig"}]},{"type":"text","value":" - used to denote the value of an arbitrary number of UTXOs. Consists of 2 64-bit unsigned integer (i.e. equivalent to 128-bit integer)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Difficulty"}]},{"type":"text","value":" - 32-bit encoding of a floating-point number. 8 bits for order, 24 bits for mantissa."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Difficulty::Raw"}]},{"type":"text","value":" - 256-bit unsigned integer. Represents an \"unpacked\" "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Difficulty"}]},{"type":"text","value":" on a linear scale. Used to represent the chainwork (sum of difficulties)."}]}]},{"type":"element","tag":"h1","props":{"id":"input-utxo"},"children":[{"type":"text","value":"Input UTXO"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Consists of the following:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ECC::Point m_Commitment"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A commitment to the UTXO (which is supposed to exist in the system)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Height m_Maturity"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Optional field to specify the maturity of the UTXO being-spent."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Used only in "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Macroblocks"}]},{"type":"text","value":" (compressed history block), more about this later. Illegal to use in transactions."}]}]}]}]},{"type":"element","tag":"h1","props":{"id":"output-utxo"},"children":[{"type":"text","value":"Output UTXO"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Consists of the following:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ECC::Point m_Commitment"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A commitment to the UTXO (which is supposed to be created in a transaction)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Height m_Maturity"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Optional field to specify the maturity of the created UTXO."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Used only in "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Macroblocks"}]},{"type":"text","value":" (compressed history block), more about this later. Illegal to use in transactions."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"bool m_Coinbase"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Must be set iff it's a coinbase UTXO."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Height m_Incubation"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Optional field. If specified - the number of extra blocks (in addition to standard system rules) until the UTXO becomes mature."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"UTXO Signature. Must be one of the following:\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ECC::RangeProof::Confidential"}]},{"type":"text","value":" - a confidential signature (Bulletproof)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ECC::RangeProof::Public"}]},{"type":"text","value":" - a public signature, with the Amount visible."}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"utxo-signature"},"children":[{"type":"text","value":"UTXO Signature"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Coinbase UTXO must have a public signature (the Amount explicitly specified)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Non-coinbase UTXO - depends on the system rules. In the current configuration all non-coinbase UTXOs are enforced to have a confidential signature, but may also be configured to allow public signatures."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The confidential signature is implemented in terms of a Bulletproof. The public signature consists of the following:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Amount m_Value"}]},{"type":"text","value":" - the explicit value"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ECC::Signature m_Signature"}]},{"type":"text","value":" - a Schnorr's signature for the UTXO blinding factor."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Note"}]},{"type":"text","value":": the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"m_Incubation"}]},{"type":"text","value":" field is accounted in the UTXO signature, to prevent tampering."}]},{"type":"element","tag":"h1","props":{"id":"transaction-kernel"},"children":[{"type":"text","value":"Transaction Kernel"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Consists of the following:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ECC::Point m_Excess"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The transaction excess (public)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ECC::Signature m_Signature"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The Schnorr's signature for the whole kernel body, signed with the transaction excess (secret)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Amount m_Fee"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Transaction fee"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"uint64_t m_Multiplier"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Optional field, used in a scheme where a kernel may be consumed (more about this later)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"HeightRange m_Height"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Optional: the transaction timelock parameters (min/max height for being valid in the block)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"uintBig m_HashLock"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Optional: a hashlock. An arbitrary 256-bit value which is hashed, and then accounted in the kernel signature"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"m_vNested"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Optional: an array of "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"nested"}]},{"type":"text","value":" kernels. More about this later."}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"kernel-signature"},"children":[{"type":"text","value":"Kernel Signature"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Hash of the kernel is evaluated, and then it's signed by the Schnorr's signature. The Hash evaluation formula is:"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"pre","props":{"code":"M = m_Fee | m_Height | m_Excess | m_Multiplier;\nif Hashlock specified\nM = M | true | Hash(Hashlock.Preimage);\nelse\n  M = M | false;\n\nFor each Nested Kernel\n   M = M | true | (Nested Kernel).ID;\n\nM = M | false\n\nKernelHash = Hash(M)\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"M = m_Fee | m_Height | m_Excess | m_Multiplier;\nif Hashlock specified\nM = M | true | Hash(Hashlock.Preimage);\nelse\n  M = M | false;\n\nFor each Nested Kernel\n   M = M | true | (Nested Kernel).ID;\n\nM = M | false\n\nKernelHash = Hash(M)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The formula accounts for all the members except except the signature. It's also unambiguous (i.e. explicit separation for optional input fields)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Note"}]},{"type":"text","value":": The excess, which is a signature public key, is also included. This is an intentional design decision, to make the kernel's excess also immutable after it has been signed (otherwise any party could modify the excess and keep the signature correct)."}]},{"type":"element","tag":"h2","props":{"id":"kernel-id"},"children":[{"type":"text","value":"Kernel ID"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"According to the system rules every kernel has a unique ID (duplicate IDs are banned). Its value is identical to the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"KernelHash"}]},{"type":"text","value":", except there are \"forbidden\" values, which are reserved for the internal system use. So if the kernel ID happens to be equal to a forbidden value (which is highly unlikely), its value is mutated."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Currently the only forbidden value is 0."}]},{"type":"element","tag":"h1","props":{"id":"transaction"},"children":[{"type":"text","value":"Transaction"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Consists of the following:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Input UTXOs"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Output UTXOs"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Input Kernels\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"This is the BEAM extension - kernels may also be consumed! More about this later."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Output Kernels"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"ECC::Scalar m_Offset"}]}]}]},{"type":"element","tag":"h2","props":{"id":"context-free-transaction-validation"},"children":[{"type":"text","value":"Context-free Transaction validation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following is validated:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"All the transaction elements (UTXOs, Kernels) must be specified in a well-defined order (there's a comparison function for each transaction element type)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Each element must have a valid signature"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Timelocks of all the kernels must be valid for the current height"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next, we define the "},{"type":"element","tag":"b","props":{},"children":[{"type":"text","value":"Σ"}]},{"type":"text","value":" as a sum of all outputs minus all inputs:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"b","props":{},"children":[{"type":"text","value":"Σ"}]},{"type":"text","value":" = Σ(UTXO-Out.Commit) - Σ(UTXO-In.Commit) + Σ(Kernel-Out.Excess) - Σ(Kernel-In.Excess) + m_Offset · G"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In case of transaction validation there are transaction fees that are considered lost, i.e. they are implicit outputs. So, the validation formula is:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"b","props":{},"children":[{"type":"text","value":"Σ"}]},{"type":"text","value":" + Σ(Fees)·H = 0"}]},{"type":"element","tag":"h1","props":{"id":"block-body"},"children":[{"type":"text","value":"Block body"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Contains all that is included in a transaction. In addition:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"AmountBig m_Subsidy"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"explicit Amount created by this block (Coinbase and, possibly, other types of subsidy)"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"bool m_SubsidyClosing"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If set - means from the next block only coinbase subsidy should be allowed"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Since blocks may be arbitrary large (when merged) - there are different underlying techniccal representations of the Block body. In a simple case it contains just arrays of all the transaction elements (like a Transaction object). But larger blocks don't keep all the data pre-loaded, instead it's read sequentially from files."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There is an "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"Transaction::IReader"}]},{"type":"text","value":" interface used to iterate sequentially over the transaction elements, and it's used by the context-free validation code, regardless to the actual data representation details."}]},{"type":"element","tag":"h2","props":{"id":"context-free-block-body-validation"},"children":[{"type":"text","value":"Context-free Block body validation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The block body is validated similar to a transaction, keeping in mind however that this may be a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Macroblock"}]},{"type":"text","value":", i.e. a merged block for a specific height range (applicable to the Timelock validation of kernels)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then "},{"type":"element","tag":"b","props":{},"children":[{"type":"text","value":"Σ"}]},{"type":"text","value":" is calculated. But in contrast to transaction the Fees should not be added, because they must have already been consumed by explicit output UTXO(s) (injected by the miner). Instead the explicit Subsidy must be accounted as an input. Hence the formula is:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"b","props":{},"children":[{"type":"text","value":"Σ"}]},{"type":"text","value":" - m_Subsidy·H = 0"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In addition the Verifier must verify that the Coinbase UTXOs are properly tagged, and unspent unless the coinbase maturity is reached.\nFor a single block verification the sum of all Coinbase UTXO amount must be equal to the single block Coinbase emission as defined by the system rules.\nFor "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Macroblock"}]},{"type":"text","value":" verification the Verifier should take into account that some Coinbase UTXOs may have already been spent."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"utxo-signature","depth":3,"text":"UTXO Signature"},{"id":"kernel-signature","depth":2,"text":"Kernel Signature"},{"id":"kernel-id","depth":2,"text":"Kernel ID"},{"id":"context-free-transaction-validation","depth":2,"text":"Context-free Transaction validation"},{"id":"context-free-block-body-validation","depth":2,"text":"Context-free Block body validation"}]}},"_type":"markdown","_id":"content:docs:core-tech:Core-transaction-elements.md","_source":"content","_file":"docs/core-tech/Core-transaction-elements.md","_extension":"md"}
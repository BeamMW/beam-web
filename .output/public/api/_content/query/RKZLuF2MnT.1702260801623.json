{"_path":"/docs/core-tech/mimblewimble-whitepaper-(june-2016)","_dir":"core-tech","_draft":false,"_partial":false,"_locale":"","title":"Mimblewimble Whitepaper (June 2016)","description":"MIMBLEWIMBLE\nTom Elvis Jedusor\n19 July, 2016","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"MIMBLEWIMBLE\nTom Elvis Jedusor\n19 July, 2016"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"**"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"/\nIntroduction\n/"}]},{"type":"text","value":"**\\"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bitcoin is the first widely used financial system for which all the necessary\ndata to validate the system status can be cryptographically verified by anyone.\nHowever, it accomplishes this feat by storing all transactions in a public\ndatabase called \"the blockchain\" and someone who genuinely wishes to check\nthis state must download the whole thing and basically replay each transaction,\ncheck each one as they go. Meanwhile, most of these transactions have not\naffected the actual final state (they create outputs that are destroyed\na transaction later)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"At the time of this writing, there were nearly 150 million transactions\ncommitted in the blockchain, which must be replayed to produce a set of\nonly 4 million unspent outputs."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It would be better if an auditor needed only to check data on the outputs\nthemselves, but this is impossible because they are valid if and only if the\noutput is at the end of a chain of previous outputs, each signs the next. In\nother words, the whole blockchain must be validated to confirm the final\nstate."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Add to this that these transactions are cryptographically atomic, it is clear\nwhat outputs go into every transaction and what emerges. The \"transaction graph\"\nresulting reveals a lot of information and is subjected to analysis by many\ncompanies whose business model is to monitor and control the lower classes.\nThis makes it very non-private and even dangerous for people to use."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Some solutions to this have been proposed. Greg Maxwell discovered to encrypt\nthe amounts, so that the graph of the transaction is faceless but still allow\nvalidation that the sums are correct "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":". Dr Maxwell also produced CoinJoin,\na system for Bitcoin users to combine interactively transactions, confusing\nthe transaction graph. Nicolas van Saberhagen has developed a system to blind\nthe transaction entries, goes much further to cloud the transaction graph (as\nwell as not needed the user interaction) "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"3"}]},{"type":"text","value":". Later, Shen Noether combined\nthe two approaches to obtain \"confidential transactions\" of Maxwell AND the\ndarkening of van Saberhagen "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"4"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These solutions are very good and would make Bitcoin very safe to use. But\nthe problem of too much data is made even worse. Confidential transactions\nrequire multi-kilobyte proofs on every output, and van Saberhagen signatures\nrequire every output to be stored for ever, since it is not possible to tell\nwhen they are truly spent."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dr. Maxwell's CoinJoin has the problem of needing interactivity. Dr. Yuan Horas\nMouton fixed this by making transactions freely mergeable "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"5"}]},{"type":"text","value":", but he needed to\nuse pairing-based cryptography, which is potentially slower and more difficult\nto trust. He called this \"one-way aggregate signatures\" (OWAS)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"OWAS had the good idea to combine the transactions in blocks. Imagine that we\ncan combine across blocks (perhaps with some glue data) so that when the outputs\nare created and destroyed, it is the same as if they never existed. Then, to\nvalidate the entire chain, users only need to know when money is entered into\nthe system (new money in each block as in Bitcoin or Monero or peg-ins for\nsidechains "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"6"}]},{"type":"text","value":") and final unspent outputs, the rest can be removed and forgotten.\nThen we can have Confidential Transactions to hide the amounts and OWAS to blur\nthe transaction graph, and use LESS space than Bitcoin to allow users to fully\nverify the blockchain. And also imagine that we must not pairing-based cryptography\nor new hypotheses, just regular discrete logarithms signatures like Bitcoin.\nHere is what I propose."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I call my creation Mimblewimble because it is used to prevent the blockchain from\ntalking about all user's information "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"7"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"**"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"/\nConfidential Transactions and OWAS\n/"}]},{"type":"text","value":"**\\"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The first thing we need to do is remove Bitcoin Script. This is sad, but it is too\npowerful so it is impossible to merge transactions using general scripts. We will\ndemonstrate that confidential transactions of Dr. Maxwell are enough (after some\nsmall modification) to authorize spending of outputs and also allows to make\ncombined transactions without interaction. This is in fact identical to OWAS,\nand allows relaying nodes take some transaction fee or the recipient to change\nthe transaction fees. These additional things Bitcoin can not do, we get for free."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We start by reminding the reader how confidential transactions work. First, the\namounts are coded by the following equation:"}]},{"type":"element","tag":"pre","props":{"code":"C = r*G + v*H\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"C = r*G + v*H\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"where C is a Pedersen commitment, G and H are fixed nothing-up-my-sleeve elliptic\ncurve group generators, v is the amount, and r is a secret random blinding key."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Attached to this output is a rangeproof which proves that v is in "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"0, 2^64"}]},{"type":"text","value":", so\nthat user cannot exploit the blinding to produce overflow attacks, etc."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To validate a transaction, the verifer will add commitments for all outputs, plus\nf*H (f here is the transaction fee which is given explicitly) and subtracts all\ninput commitments. The result must be 0, which proves that no amount was created\nor destroyed overall."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We note that to create such a transaction, the user must know the sum of all the\nvalues of r for commitments entries. Therefore, the r-values (and their sums) act\nas secret keys. If we can make the r output values known only to the recipient,\nthen we have an authentication system! Unfortunately, if we keep the rule that\ncommits all add to 0, this is impossible, because the sender knows the sum of\nall "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"his"}]},{"type":"text","value":" r values, and therefore knows the receipient's r values sum to the\nnegative of that. So instead, we allow the transaction to sum to a nonzero value\nk*G, and require a signature of an empty string with this as key, to prove its\namount component is zero."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We let transactions have as many k*G values as they want, each with a signature,\nand sum them during verification."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To create transactions sender and recipient do following ritual:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Sender and recipient agree on amount to be sent. Call this b."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Sender creates transaction with all inputs and change output(s), and gives\nrecipient the total blinding factor (r-value of change minus r-values of\ninputs) along with this transaction. So the commitments sum to r"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"G - b"}]},{"type":"text","value":"H."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Recipient chooses random r-values for his outputs, and values that sum\nto b minus fee, and adds these to transaction (including range proof).\nNow the commitments sum to k"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"G - fee"}]},{"type":"text","value":"H for some k that only recipient\nknows."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Recipient attaches signature with k to the transaction, and the explicit\nfee. It has done."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, creating transactions in this manner supports OWAS already. To show this,\nsuppose we have two transactions that have a surplus k1"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"G and k2"}]},{"type":"text","value":"G, and the\nattached signatures with these. Then you can combine the lists of inputs and\noutputs of the two transactions, with both k1"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"G and k2"}]},{"type":"text","value":"G to the mix, and\nvoilá! is again a valid transaction. From the combination, it is impossible to\nsay which outputs or inputs are from which original transaction."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Because of this, we change our block format from Bitcoin to this information:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Explicit amounts for new money (block subsidy or sidechain peg-ins) with\nwhatever else data this needs. For a sidechain peg-in maybe it references\na Bitcoin transaction that commits to a specific excess k*G value?"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Inputs of all transactions"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Outputs of all transactions"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Excess k*G values for all transactions"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each of these are grouped together because it do not matter what the transaction\nboundaries are originally. In addition, Lists 2 3 and 4 should be required to be\ncoded in alphabetical order, since it is quick to check and prevents the block\ncreator of leaking any information about the original transactions."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that the outputs are now identified by their hash, and not by their position\nin a transaction that could easily change. Therefore, it should be banned to have\ntwo unspent outputs are equal at the same time, to avoid confusion."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"**"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"/\nMerging Transactions Across Blocks\n/"}]},{"type":"text","value":"**\\"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, we have used Dr. Maxwell's Confidential Transactions to create a noninteractive\nversion of Dr. Maxwell's CoinJoin, but we have not seen the last of marvelous Dr. Maxwell!\nWe need another idea, transaction cut-through, he described in "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"8"}]},{"type":"text","value":". Again, we create a\nnoninteractive version of this, and to show how it is used with several blocks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We can imagine now each block as one large transaction. To validate it, we add all the\noutput commitments together, then subtracts all input commitments, k*G values, and all\nexplicit input amounts times H. We find that we could combine transactions from two\nblocks, as we combined transactions to form a single block, and the result is again\na valid transaction. Except now, some output commitments have an input commitment exactly\nequal to it, where the first block's output was spent in the second block. We could\nremove both commitments and still have a valid transaction. In fact, there is not even\nneed to check the rangeproof of the deleted output."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The extension of this idea all the way from the genesis block to the latest block, we\nsee that EVERY nonexplicit input is deleted along with its referenced output. What\nremains are only the unspent outputs, explicit input amounts and every k"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"G value.\nAnd this whole mess can be validated as if it were one transaction: add all unspent\ncommitments output, subtract the values k"}]},{"type":"text","value":"G, validate explicit input amounts (if there\nis anything to validate) then subtract them times H. If the sum is 0, the entire\nchain is good."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What is this mean? When a user starts up and downloads the chain he needs the following\ndata from each block:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Explicit amounts for new money (block subsidy or sidechain peg-ins) with\nwhatever else data this needs."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Unspent outputs of all transactions, along with a merkle proof that each\noutput appeared in the original block."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Excess k*G values for all transactions."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bitcoin today there are about 423000 blocks, totaling 80GB or so of data on the hard\ndrive to validate everything. These data are about 150 million transactions and 5 million\nunspent nonconfidential outputs. Estimate how much space the number of transactions\ntake on a Mimblewimble chain. Each unspent output is around 3Kb for rangeproof and\nMerkle proof. Each transaction also adds about 100 bytes: a k*G value and a signature.\nThe block headers and explicit amounts are negligible. Add this together and get\n30Gb -- with a confidential transaction and obscured transaction graph!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"**"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"/\nQuestions and Intuition\n/"}]},{"type":"text","value":"**\\"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here are some questions that since these weeks, dreams asked me and I woke up sweating.\nBut in fact it is OK."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Q. If you delete the transaction outputs, user cannot verify the rangeproof and maybe\na negative amount is created."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A. This is OK. For the entire transaction to validate all negative amounts must have\nbeen destroyed. User have SPV security only that no illegal inflation happened in\nthe past, but the user knows that "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"at this time"}]},{"type":"text","value":" no inflation occurred."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Q. If you delete the inputs, double spending can happen."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A. In fact, this means: maybe someone claims that some unspent output was spent\nin the old days. But this is impossible, otherwise the sum of the combined transaction\ncould not be zero."}]},{"type":"element","tag":"pre","props":{"code":" An exception is that if the outputs are amount zero, it is possible to make two that\n are negatives of each other, and the pair can be revived without anything breaks. So to\n prevent consensus problems, outputs 0-amount should be banned. Just add H at each output,\n now they all amount to at least 1.\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":" An exception is that if the outputs are amount zero, it is possible to make two that\n are negatives of each other, and the pair can be revived without anything breaks. So to\n prevent consensus problems, outputs 0-amount should be banned. Just add H at each output,\n now they all amount to at least 1.\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"**"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"/\nFuture Research\n/"}]},{"type":"text","value":"**\\"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here are some questions I can not answer at the time of this writing."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"What script support is possible? We would need to translate script operations into\nsome sort of discrete logarithm information."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"We require user to check all k"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"G values, when in fact all that is needed is that their\nsum is of the form k"}]},{"type":"text","value":"G. Instead of using signatures is there another proof of discrete\nlogarithm that could be combined?"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"There is a denial-of-service option when a user downloads the chain, the peer can give\ngigabytes of data and list the wrong unspent outputs. The user will see that the result\ndo not add up to 0, but cannot tell where the problem is."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"For now maybe the user should just download the blockchain from a Torrent or something\nwhere the data is shared between many users and is reasonably likely to be correct."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"https://people.xiph.org/~greg/confidential_values.txt","rel":["nofollow"]},"children":[{"type":"text","value":"https://people.xiph.org/~greg/confidential_values.txt"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"2"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"https://bitcointalk.org/index.php?topic=279249.0","rel":["nofollow"]},"children":[{"type":"text","value":"https://bitcointalk.org/index.php?topic=279249.0"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"3"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"https://cryptonote.org/whitepaper.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"https://cryptonote.org/whitepaper.pdf"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"4"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"https://eprint.iacr.org/2015/1098.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"https://eprint.iacr.org/2015/1098.pdf"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"5"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"https://download.wpsoftware.net/bitcoin/wizardry/horasyuanmouton-owas.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"https://download.wpsoftware.net/bitcoin/wizardry/horasyuanmouton-owas.pdf"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"6"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"http://blockstream.com/sidechains.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"http://blockstream.com/sidechains.pdf"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"7"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"http://fr.harrypotter.wikia.com/wiki/Sortil%C3%A8ge_de_Langue_de_Plomb","rel":["nofollow"]},"children":[{"type":"text","value":"http://fr.harrypotter.wikia.com/wiki/Sortilège_de_Langue_de_Plomb"}]},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"8"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"https://bitcointalk.org/index.php?topic=281848.0","rel":["nofollow"]},"children":[{"type":"text","value":"https://bitcointalk.org/index.php?topic=281848.0"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:docs:core-tech:Mimblewimble-Whitepaper-(June-2016).md","_source":"content","_file":"docs/core-tech/Mimblewimble-Whitepaper-(June-2016).md","_extension":"md"}
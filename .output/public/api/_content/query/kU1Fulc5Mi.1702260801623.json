{"_path":"/docs/core-tech/thoughts-about-eliminating-transaction-kernels","_dir":"core-tech","_draft":false,"_partial":false,"_locale":"","title":"Thoughts About Eliminating Transaction Kernels","description":"","body":{"type":"root","children":[{"type":"element","tag":"h3","props":{"id":"transaction-and-kernels"},"children":[{"type":"text","value":"Transaction and kernels"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One of the fundamental features of a MimbleWimble transaction is the "},{"type":"element","tag":"u","props":{},"children":[{"type":"text","value":"irreversibility"}]},{"type":"text","value":". That is, once the transaction enters the blockchain, it can't be reversed, which guarantees that once a user receives the coins, the sender can't \"change his mind\" later."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is achieved by transaction "},{"type":"element","tag":"u","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"kernels"}]}]},{"type":"text","value":", which are cryptographically signed, and encode (among other things) the total blinding factor of the transaction. While a UTXO can be either consumed or created by the transaction, the kernels can only be created, and never consumed. This guarantees the irreversibility of the transaction."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This leads to the accumulation of the transaction kernels in the system with time. While the UTXOs denote the \"live\" coins, which can be spent by their owners, the transaction kernels are actually \"dead weight\", and play no role in future transactions. OTOH the fully-functional processing node is obliged to keep them forever, in order to allow for new nodes to sync and verify the most recent blockchain state."}]},{"type":"element","tag":"h3","props":{"id":"how-to-consume-the-transaction-kernels-principles"},"children":[{"type":"text","value":"How to consume the transaction kernels - principles"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's assume that transaction kernels can also be consumed, and a valid transaction can contain transaction kernels on both input and output sides. In order to keep the irreversibility principle we apply additional restrictions on the output kernels, such that the verifier can:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Verify that for each input kernel there's a corresponding output kernel, that can only be signed if its creator(s) know the opening of the input kernel."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Such a transaction is irreversible \"on its own\". Means - input and output kernels can't be exchanged."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The above rules must also hold when transactions are merged and intermediate outputs are fully deleted."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"In addition the output kernel should remain compact, and not inflate with every such a transaction. There's no benefit of keeping one large kernel vs many small ones."}]}]},{"type":"element","tag":"h1","props":{"id":"proposal"},"children":[{"type":"text","value":"Proposal"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Kernel consists of the following fields:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Public excess: the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"k*G"}]},{"type":"text","value":" curve point, whereas the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"k"}]},{"type":"text","value":" is the total blinding of the transaction."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Various optional fields (fee, block height, custom co-signed contract, nested kernels)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Schnorr's signature of the kernel body, whereas the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"k"}]},{"type":"text","value":" is the signature private key."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The blinding factor "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"k"}]},{"type":"text","value":" is the sum of the total blinding factors of all the participants, and the kernel is co-signed collectively."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's add additional field to the kernel:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"m"}]},{"type":"text","value":" - Multiplier, a 64-bit integer."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If not specified - by default it's assumed to be 1. The actual transaction excess is "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"mk*G"}]},{"type":"text","value":", i.e. multiplied by "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"m"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"During the transaction verification, the verifier must ensure that for every input kernel there is a corresponding output kernel, which:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Has the same unmultiplied excess "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"kG"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Has a multiplier which is "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"greater"}]},{"type":"text","value":" than that of the input kernel."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It's easy to see that such a scheme conforms to the rules 1-4."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"In order to co-sign the new kernel, the participants "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"must"}]},{"type":"text","value":" know the "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"mk"}]},{"type":"text","value":", hence they know "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"k"}]},{"type":"text","value":". Means - those are the same participants that signed the input kernel."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Such a transaction is irreversible, since the output multiplier must be (strictly) greater than the input."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When such a procedure repeated many times, and intermediate outputs are deleted - we have the same "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"kG"}]},{"type":"text","value":" correspondence, and the same inequality for multipliers."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The kernel remains compact, its size is independent of the reuse count (up to order of 2"},{"type":"element","tag":"sup","props":{},"children":[{"type":"text","value":"64"}]},{"type":"text","value":")."}]}]},{"type":"element","tag":"h1","props":{"id":"remarks"},"children":[{"type":"text","value":"Remarks"}]},{"type":"element","tag":"h3","props":{"id":"how-to-encourage-this-scheme"},"children":[{"type":"text","value":"How to encourage this scheme"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Naturally users are not obliged to consume their old kernels, and are free to create new ones (even several kernels) with every transaction.\nHowever we'd like to encourage this scheme. Hence we'll define an "},{"type":"element","tag":"u","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"implicit kernel fee"}]}]},{"type":"text","value":". So that consuming old kernels will be beneficial to the users.\nOptionally this fee may depend on the kernel size (the size of a single kernel is limited, but it may contain arbitrary number of nested kernels)."}]},{"type":"element","tag":"h3","props":{"id":"how-to-use-it-in-practice"},"children":[{"type":"text","value":"How to use it in practice"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This scheme can be used by the same set of users (2 in the most common scenario), which perform several transactions.\nOn the first transaction each peaks a random "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"k"}]},{"type":"text","value":" used to construct the first transaction.\nOn the consequent transactions they decide to reuse the older kernel and increment the multiplier "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"m"}]},{"type":"text","value":" for the new kernel."}]},{"type":"element","tag":"h3","props":{"id":"degrees-of-freedom-for-newly-created-utxos"},"children":[{"type":"text","value":"Degrees of freedom for newly-created UTXOs"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The total blinding factor of each consequent transaction is pre-defined ("},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"kG"}]},{"type":"text","value":" multiplied by the multiplier difference). It may seem that due to this fact the users are restricted to pick specific blinding factors for their UTXOs (hence - making them less confident and easier to track), but this is not so.\nThe transaction, in addition to the UTXOs and kernels, contains also an arbitrary "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"offset"}]},{"type":"text","value":" - the arbitrary non-encoded blinding factor, which is summed when transactions are combined. Using this degree of freedom users can pick arbitrary blinding factors for the newly-created UTXOs."}]},{"type":"element","tag":"h3","props":{"id":"confidentiality-consideration"},"children":[{"type":"text","value":"Confidentiality consideration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One obvious thing is that anyone can see that the same set of users do several transactions. Without dandelion a hostile node can reveal the user identity (IP address) for the specific transaction that it received. If the kernel consuming scheme is used, the hostile node can also detect when the same set of users create more transactions (both in the past and in the future), even if they used another node.\nHowever it will not be able to identify and track the appropriate UTXOs (unless this hostile node actually received all those transactions)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With the use of dandelion this risk is reduced (but not removed completely)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I can't see other issues, and this specific one is minor IMHO."}]},{"type":"element","tag":"h3","props":{"id":"what-if-the-user-wants-the-kernel-to-remain-forever"},"children":[{"type":"text","value":"What if the user wants the kernel to remain forever?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"As we said, the kernels are \"dead weight\" that the processing node normally can't get rid of. But in fact kernels may encode some information useful for users. For instance, it may be a co-signed contract, which users may use later to prove the payment."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this specific case users should wait until the transaction becomes visible in the block, and obtain the "},{"type":"element","tag":"u","props":{},"children":[{"type":"text","value":"Merkle proof"}]},{"type":"text","value":" for this kernel.\nOnce they have it - they can safely reuse it. Whereas the kernel itself will eventually be deleted from the system, they still will be able to prove it was there. The proof consists of two parts:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Proof that a specific kernel was in the specific system state (blockchain height + hash)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Proof that this older state is a part of the present blockchain."}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"transaction-and-kernels","depth":3,"text":"Transaction and kernels"},{"id":"how-to-consume-the-transaction-kernels-principles","depth":3,"text":"How to consume the transaction kernels - principles"},{"id":"how-to-encourage-this-scheme","depth":3,"text":"How to encourage this scheme"},{"id":"how-to-use-it-in-practice","depth":3,"text":"How to use it in practice"},{"id":"degrees-of-freedom-for-newly-created-utxos","depth":3,"text":"Degrees of freedom for newly-created UTXOs"},{"id":"confidentiality-consideration","depth":3,"text":"Confidentiality consideration"},{"id":"what-if-the-user-wants-the-kernel-to-remain-forever","depth":3,"text":"What if the user wants the kernel to remain forever?"}]}},"_type":"markdown","_id":"content:docs:core-tech:Thoughts-about-eliminating-transaction-kernels.md","_source":"content","_file":"docs/core-tech/Thoughts-about-eliminating-transaction-kernels.md","_extension":"md"}